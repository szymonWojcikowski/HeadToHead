<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>H2H App v. 0</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
</head>
<body>
<div class="container">
   <header class="row">
     <div class="col-md-12">
       <h1 class="text-center text-secondary">Head 2 Head</h1>
       <h2 class="text-center text-warning">Lego truckers's comparison</h2>
       <div class="alert alert-warning alert-dismissible" role="alert">
          <code><strong>How to:</strong> Select a first trucker. U will see his stats (total number of races, number of wins, second, and third places, percentage of wins). Now choose his oponent. You will see his stats also. Now click "compare" button. You will see a results of direct duels (such total namber of wins, loss and draws, percentage of direct wins).</code> 
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
          </button>
        </div>
       
     </div>
   </header>
   <section class="row">
       <div class="col-sm-6 bg-secondary card-body">
           <div class="form-group">
              <label for="firstSelect" class="text-white">Select a trucker</label>
              <select class="form-control" id="firstSelect">
<!--options generated via js -->
              </select>
            </div>
       </div>
       
       <div class="col-sm-6 bg-danger card-body">
          <div class="form-group">
            <label for="selectoToCompare" class="text-light">...and choose his contestant</label>
            <select class="form-control" id="selectoToCompare">
<!--options generated via js -->
            </select>
          </div>
       </div>
   </section>
    <section class="row">
        <div class="col-sm-6 text-center bg-secondary" id="stats1">
        </div>
        <div class="col-sm-6 text-center bg-danger" id="stats2">
        </div>
 
    </section>
    <section class="row">  
        <div class="col-sm-12 text-center" id="comparison">
        </div>
    </section>
   <section class="row">
        <div class="col-sm-12 card-body text-center">
         <button type="button" class="btn btn-lg btn-success" id="compareBtn">Compare</button>
      </div>
   </section>
   

   
</div>
<!------------------to Do------------------------------->
<!--
1) sorting of options in select abcd DONE
2) languages
3) avatars for truckers
4) wywołanie f. showPosition z argumentem (nr rajdu), którego nie ma wysypuje kod (trzeba dodać obsługę błędów) DONE
5) przerobienie wypisu statystk z użyciem template strings i poprawienie adresacji odkrywanego guzikiem pola #racebyrace
- uzależnić od indexu
-->

<!----------------bootstrap4 i jego pomocnicy--------------->
 <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>

 <script>
// wyniki rajdów =
const raceInfo = [
   {
        year: 2007,
        race: 1,
        competitors: ["Pietruch", "Smyk", "Aro_Kal", "Lomero"],
        position:["1","2","3","4"]  
  },
   {
        year: 2007,
        race: 2,
        competitors: ["Smyk", "Duke", "Pietruch", "Sariel", "Liwnik"],
        position:["1","2","3","4","5"] 
  },
  {
        year: 2007,
        race: 3,
        competitors: ["Duke", "M. Drwięga", "Pietruch", "Smyk", "Sariel"],
        position:["1","2","3","4","5"] 
   },
   {
        year: 2007,
        race: 4,  
        competitors: ["Aro_Kal", "Pietruch", "Sariel", "Smyk", "Duke"],
        position:["1","2","3","4","5"] 
  },
    {
        year: 2008,
        race: 1, 
        competitors: ["Duke", "Smyk", "Aro_Kal", "Lomero", "Pietruch", "Emilus", "Richard"],
        position:["1","2","3","4","5","6","7"]
    },
    {
        year: 2008,
        race: 2,
        competitors: ["Duke", "Smyk", "Aro_Kal", "Emilus", "Sariel"],
        position:["1","2","3","4","5"]  
  },
    {
       year: 2008,
       race: 3,
       competitors: ["Duke", "Smyk", "Emilus", "Lomero", "Richard"],
       position:["1","2","3","4","5"]  
  },
    {
        year: 2008,
        race: 4,
        competitors: ["Smyk", "Duke", "Emilus"],
        position:["1","2","3"] 
  },
    {
        year: 2008,
        race: 5,
        competitors: ["Duke", "Emilus", "Lomero", "Skuter", "Smyk"],
        position:["1","2","3","4","5"] 
  },
    {
        year: 2008,
        race: 6,
        competitors: ["Emilus", "Aro_Kal", "Duke", "Lomero"], 
        position:["1","2","3","4"] 
  },
 {
        year: 2009,
        race: 1,
        competitors: ["TT", "Smyk", "Emilus", "Aro_Kal", "Maniek", "Duke", "Atros"],
        position:["1","2","3","4","5","6","7"]
  },
  {
        year: 2009,
        race: 2,
        competitors: ["Aro_Kal", "Lomero", "Maniek", "Atros", "Smyk", "Duke", "Emilus"],
        position:["1","2","3","4","5","6","7"] 
  },
 /*----------------------------------------------------------*/
    {
        year: 2009,
        race:3,
        competitors: ["TT", "Atros", "Emilus", "Smyk", "Maniek", "Aro_Kal", "Lomero", "Don Arkada"],
        position:["1","2","3","4","4","6","7","8"]
    },
    {
        year: 2009,
        race:4,
        competitors: ["Atros", "Smyk", "Lomero", "Aro_Kal", "Maniek", "Emilus"],
        position:["1","2","3","4","4","6"]
    },
    {
        year:20099,
        race:5,
        competitors: ["Atros", "Aro_Kal", "TT", "Maniek", "Deredi", "Kuba", "Lomero", "Smyk", "Sariel"],
        position: ["1","2","3","4","5","6","7","8","9"]
    },
    {
        year: 2010,
        race:1,
        competitors:  ["Emilus", "Sami", "Atros","Grzesiek", "Smyk", "Aro_Kal", "Cieślu", "Lomero", "Deredi", "Maniek","Duke", "Sariel"],
        position: ["1","2","3","4","5","6","7","8","9","10","11","12"]
    },
    {
        year: 2010,
        race: 2,
        competitors:["TT", "Emilus", "Atros", "Grzesiek", "Smyk", "Aro_Kal", "Sariel", "Deredi", "Cieślu", "Lomero", "Janek", "Don Arkada", "Ej"],
        position: ["1","2","3","4","5","6","7","8","9","10","11","12","13"]
    },
    {
        year: 2010,
        race:3,
        competitors: ["Atros", "Deredi", "Grzesiek", "Cieślu", "Emilus", "Smyk", "Lomero", "Ej", "Maniek", "Don Arkada", "Sariel"],
        position:["1","2","3","4","5","6","7","8","9","10","11"]
    },
    {
        year: 2010,
        race: 4,
        competitors: ["Atros", "Emilus", "Cieślu", "Maniek", "Sami", "Smyk", "Lomero", "Ej","Sariel", "Krzoso"],
        position: ["1","2","3","4","5","6","6","8","9","10"]
    },
    {
        year:2010,
        race:5,
        competitors: ["Emilus", "Atros", "Ej", "Smyk", "TT", "Cieślu", "Maniek", "Lomero", "Grzesiek", "Sariel"],
        position: ["1","2","3","4","5","6","7","8","9","10"]
    },
    {
        year: 2010,
        race: 6,
        competitors: ["Atros", "Emilus", "Grzesiek", "Dominik", "Lomero", "Cieślu", "Smyk", "Maniek", "Ej", "lyyar", "Sariel", "Krzoso"],
        position: ["1","2","3","4","5","6","7","8","9","10","11","12"]
    },
    {
        year: 2011,
        race: 1,
        competitors: ["Atros", "Maniek", "TT", "Emilus", "Smyk", "Grzesiek", "Lomero", "3dom", "William", "Cieślu", "Bartolini", "lyyar"],
        position: ["1","2","3","4","5","6","7","8","9","10","11","11"]
    },
    {
        year: 2011,
        race: 2,
        competitors: ["Grzesiek", "TT", "Atros", "Emilus", "Maniek", "Smyk", "Cieślu", "Lomero", "M4rc!n", "3dom", "William", "Ej", "Pimpur"],
        position: ["1","1","3","4","5","6","7","8","8","10","11","11","13"]
    },
    {
        year:2011,
        race:3,
        competitors: ["Atros", "TT", "Maniek", "Cieślu", "Smyk", "William", "Krzoso", "Komando", "Ej", "Nenio", "Bartek213", "Waler93", "3dom"],
        position: ["1","2","3","4","5","6","7","8","9","9","11","12","13"]
    },

//----------------LTTC----------------------start-------------------//
    {
        year:2011,
        race:4,
        competitors: ["Atros", "Emilus", "Smyk", "Mistakes", "Grzesiek", "Maniek", "BJ", "Krzosu", "Eric Trax", "Ej", "3dom", "Artolini", "Sariel"],
        position: ["1","2","3","4","5","6","7","8","9","10","11","11","11"]
    },
    {
        year: 2011,
        race: 5,
        competitors: ["Emilus", "Grzesiek", "Atros", "Maniek", "Karde", "TT", "BJ", "Mistakes", "Cieślu", "William", "Ej","Blaha","Eric","Smyk"],
        position: ["1","2","3","4","5","6","7","8","9","10","11","11","11","11"]
    },
    {
        year: 2011,
        race: 6,
        competitors: ["Emilus", "Atros", "Smyk", "Mistakes", "Grzesiek", "Maniek", "3dom", "BJ", "TT"],
        position: ["1","2","3","4","5","6","7","8","9"]
    },
    {
        year:2012,
        race:1,
        competitors: ["Atros", "Grzesiek", "Smyk", "TT", "Emilus", "Cieślu", "Mistakes", "BJ", "Blaha", "William", "Maniek", "3dom"],
        position: ["1","2","3","3","5","6","7","8","8","10","11","11"]
    },
    {
        year:2012,
        race: 2,
        competitors: ["TT", "Atros", "Mistakes", "BJ", "Smyk", "Emilus", "Eric Trax", "Cieślu", "Jerryp", "3dom", "Lomero", "Krzosu", "Jaca"],
        position: ["1","2","3","3","5","6","7","8","9","10","11","11","11"]
    },
    {
        year: 2012,
        race: 3,
        competitors: ["Atros", "Smyk", "Emilus", "TT", "Grzesiek", "3dom", "Jerryp", "BJ"],
        position: ["1","2","3","4","5","6","7","8"]
    },
    {
        year: 2012,
        race: 4,
        competitors: ["Maniek", "Smyk", "Grzesiek", "Emilus", "Atros", "BJ", "3dom", "Lomero", "Jerryp"],
        position: ["1","2","3","3","5","6","7","8","9"]
    },
    {
        year:2012,
        race:5,
        competitors: ["Maniek", "Atros", "Smyk", "Grzesiek", "Kamyk", "BJ", "William", "Eric Trax", "Jerryp", "Sebastian", "Przemo", "Jaca"],
        position: ["1","2","3","4","5","6","7","8","9","10","10","10"]
    },
    {
        year: 2012,
        race: 6,
        competitors: ["Smyk", "Maniek", "Atros", "Kamyk", "Blaha", "BJ", "TT", "Emilus", "Grzesiek", "Eric Trax", "William", "Jaca", "Cieślu", "Przemo"],
        position: ["1","2","3","3","5","6","7","8","9","10","11","11","13","14"]
    },
    {
    year: 2013,
    race: 1,
    competitors: ["TT", "Blaha", "Grzesiek", "Kamyk", "Emilus", "Atros", "Mistakes", "Jaca", "Zozoleon", "BVL", "Cieślu", "Maniek", "BJ", "PM"],
    position: ["1","2","3","4","5","5","7","8","9","9","11","12","13","14"]
},
{
    year: 2013,
    race: 2,
    competitors: ["Atros", "BJ", "Blaha", "Jaca", "Kamyk", "TT", "Mistakes", "Zozoleon", "Maniek", "Cieślu", "Grzesiek"],
    position: ["1","2","3","4","5","6","7","8","9","10","11"]
},
{
    year: 2013,
    race: 3,
    competitors: ["Blaha", "BJ", "Atros", "Smyk", "Jaca", "Mistakes", "Grzesiek", "BVL", "Maniek", "Zozoleon"],
    position:["1","2","3","4","5","6","7","8","9","10"]
},
{
    year: 2013,
    race: 4,
    competitors: ["Smyk", "BJ", "Atros", "Kamyk", "Grzesiek", "Jerryp"],
    position:["1","2","3","4","5","6"]
},
{
    year: 2013,
    race: 5,
    competitors: ["BJ", "Atros", "Smyk", "Grzesiek", "Maniek", "Kamyk", "Zozoleon", "BVL", "Cieślu"],
    position:["1","2","3","4","5","5","7","7","9"]
},
{
    year: 2013,
    race: 6,
    competitors: ["BJ", "Smyk", "Atros", "Mistakes", "Maniek", "Cieślu"],
    position: ["1","2","3","4","5","6"]
},
{
    year: 2014,
    race: 1,
    competitors: ["Atros", "BJ", "Cieślu", "Smyk", "Maniek"],
    position: ["1","2","3","4","5"]
},
{
    year: 2014,
    race: 2,
    competitors: ["Smyk", "Cieślu", "BJ", "Atros", "Maniek"],
    position: ["1","2","3","4","5"]
},
{
    year: 2014,
    race: 3,
    competitors: ["BJ", "Atros", "Maniek", "Mistakes", "Smyk"],
    position: ["1","2","3","4","5"]
},
{
    year: 2014,
    race: 4,
    competitors: ["Atros", "Grzesiek", "Jaca", "Kamyk", "Smyk", "Blaha", "Seba", "BJ", "Emilus", "Kubrick"],
    position: ["1","1","3","4","5","6","7","8","9","10"]
},
{
    year: 2014,
    race: 5,
    competitors: ["Atros", "BJ", "Maniek", "Cieślu", "Smyk"],
    position: ["1","2","3","4","5"]
},
{
    year: 2014,
    race: 6,
    competitors: ["William", "Atros", "BJ", "Maniek", "Cieślu", "Smyk"],
    position: ["1","2","3","4","5","6"]
},
{
    year: 2015,
    race: 1,
    competitors: ["Atros", "BJ", "Emilus", "Cieślu", "Mistakes", "William"],
    position: ["1","2","3","4","5","6"]
},
{
    year: 2015,
    race: 2,
    competitors: ["Smyk", "BJ", "Atros", "Waller93", "William", "Cieślu", "Maniek", "Mistakes"],
    position: ["1","2","3","4","5","6","7","8"]
},
{
    year: 2015,
    race: 3,
    competitors: ["Atros", "Cieślu", "Smyk", "BJ", "Maniek", "William", "Waler93"],
    position: ["1","2","3","4","5","6","7"]
},
{
    year: 2015,
    race: 4,
    competitors: ["BJ", "Atros", "Smyk", "William"],
    position: ["1","2","3","4"]
},
{
    year: 2015,
    race: 5,
    competitors: ["BJ", "Atros", "William", "Mistakes", "Smyk", "Cieślu"],
    position: ["1","2","3","4","5","5"]
},
{
    year: 2015,
    race: 6,
    competitors: ["William", "Smyk", "BJ", "Cieślu", "Atros"],
    position: ["1","2","2","4","5"]
},
{
    year: 2016,
    race: 1,
    competitors: ["Maniek", "William", "Smyk", "Atros", "Mistakes", "TT", "Cieślu", "BJ", "Omen"],
    position: ["1","2","3","4","5","6","7","8","9"]
},
{
    year: 2016,
    race: 2,
    competitors: ["William", "Maniek", "BJ", "TT", "Smyk", "Atros", "Cieślu", "Omen"],
    position: ["1","2","3","4","5","6","7","7"]
},
{
    year: 2016,
    race: 3,
    competitors: ["Atros", "Smyk", "Maniek", "Maciek", "BJ", "Omen"],
    position: ["1","2","3","4","5","6"]
},
{
    year: 2016,
    race: 4,
    competitors: ["Atros", "Smyk", "Omen", "William", "BJ", "Cieślu"],
    position: ["1","2","3","4","5","6"]
},
{
    year: 2016,
    race: 5,
    competitors: ["Smyk", "BJ", "Atros", "Omen", "Cieślu"],
    position: ["1","1","3","4","5"]
},
{
    year: 2016,
    race: 6,
    competitors: ["Atros", "BJ", "Omen", "William", "Smyk", "Cieślu"],
    position: ["1","2","3","4","5","6"]
},
{
    year: 2017,
    race: 1,
    competitors: ["Atros", "Omen", "BJ", "Smyk", "Cieślu", "William", "Mistakes"],
    position: ["1","2","3","4","5","6","7"]
},
{
    year: 2017,
    race: 2,
    competitors: ["Atros", "BJ", "Omen", "Smyk", "Mistakes"],
    position: ["1","2","3","4","5"]
},
{
    year: 2017,
    race: 3,
    competitors: ["Omen", "Atros", "Smyk", "BJ", "Cieślu"],
    position: ["1","2","3","4","5"]
},
{
    year: 2017,
    race: 4,
    competitors: ["Omen", "Atros", "BJ", "Smyk"],
    position: ["1","2","3","4"]
},
{
    year: 2017,
    race: 5,
    competitors: ["Omen", "Atros", "Smyk", "BJ", "Cieślu", "Mistakes"],
    position: ["1","2","3","3","5","6"]
},
{
    year: 2017,
    race: 6,
    competitors: ["Kamyk", "Omen", "Atros", "Mistakes", "Smyk", "BJ", "Cieślu"],
    position: ["1","2","3","4","5","6","7"]
}
];

//-------------rozszerzenia prototypów tablic-----------------
Array.prototype.contains = function(v) {
    for(let i = 0; i < this.length; i++) {
        if(this[i] === v) return true;
    }
    return false;
};

Array.prototype.unique = function() {
    let arr = [];
    for(let i = 0; i < this.length; i++) {
        if(!arr.contains(this[i])) {
            arr.push(this[i]);
        }
    }
    return arr;
};

//-------------rozszerzenia prototypów-------------------------
//polyfill dla przeglądarek nie obsługujących closest
if (!Element.prototype.remove) {
    Element.prototype.remove = function() {
        this.parentElement.removeChild(this);
    }
}

//=============diagnostyka danych z rajdami===================
function dataCheck() {
    let nrOfCorrectRaces = 0;
    for (let i = 0; i < raceInfo.length; i++) {

        if (raceInfo[i].competitors.length === raceInfo[i].position.length) {
            nrOfCorrectRaces++;
        }
        else {
            console.error("Błędny index " + i + " Rok " + raceInfo[i].year + " rajd " + raceInfo[i].race)
        }
    }
    console.log("--------------------\n" + nrOfCorrectRaces + " poprawnych rajdów\n" + "--------------------");
}

dataCheck();


//---------deklaracja funkcji odpowiedzialnej za wyświetlanie wyników w konsoli
const drawResults = function(rYear, rRace, rPosition, rCompetitor) {
   if (rPosition !== undefined) {
        console.info(rPosition + " miejsce: " + rCompetitor);
   }
};


//---------tablica zbierająca z każdego rajdu liczbę uczestników ---------
let howMany = [];
    
raceInfo.forEach((el) => {
    howMany.push(el.position.length);
    console.log(el.year + "#" + el.race + " startowało: " + el.position.length);
});


//---------sprawdzamy maksymalną liczbę uczestników------------------------
const mostCompetitors = Math.max(...howMany);
console.info("%cRekordowa liczba uczestników: " + mostCompetitors, "font-weight: 700;");


//----------pętle wywołujące funkcję wyświetlającą wyniki w konsoli---------   
const drawingResultsLoops = function () {
    for (let i = 0; i < raceInfo.length; i++) {
        console.log("%c" + raceInfo[i].year + " race#" + raceInfo[i].race, "font-size: 14px;");

        for (let j = 0; j < mostCompetitors; j++) {
            drawResults(raceInfo[i].year, raceInfo[i].race, raceInfo[i].position[j], raceInfo[i].competitors[j]);
        }
        console.log("----------------");
    }
};

drawingResultsLoops();
   
//------------------wyświetlanie pozycji zawodnika w konsoli------------
const showPosition = function(raceNr, who) {
    if (raceNr < raceInfo.length) {
        let idWho = raceInfo[raceNr].competitors.indexOf(who);
        let raceNumber = 1 + parseInt(raceNr);
        let whoPosition = raceInfo[raceNr].position[idWho];
        if (whoPosition === undefined) {
            console.log(who + " w tym rajdzie nie startował.");
        }
        else {
            console.log(who + " na rajdzie " + raceNumber + " był " + whoPosition);
        }
    }
    else {
        console.log("Tego rajdu jeszcze nie było.");
    }
};

//------------pobranie selectów i dodanie nasłuchu--------------
const selects = document.getElementsByTagName("select");

for (let i = 0; i < selects.length; i++) {
    selects[i].addEventListener("change", function() {
        //let who = this.options[this.selectedIndex].value;

        let context = this;
        console.error('Wybrałeś: ' + this.options[this.selectedIndex].value);
        showSelectedTruckerAndDisplayStats(context, i);

        clearingComparison();

        console.log(this);
        if (this.id === "firstSelect") {
            console.log("trzeba wywołać dodatkową funkcję do stworzenia listy oponentów");
            prepareSecondSelect();
        }
    });
}

//------------tworzymy tablicę ze wszystkich pojedyńczych występów na rajdzie-------------------
   
let competitorsToSelect = [];
for (let i = 0; i < raceInfo.length; i++) {
  competitorsToSelect = competitorsToSelect.concat(raceInfo[i].competitors);
  console.info("pętla nr " + i + ", dodani uczestnicy " + raceInfo[i].competitors);
}
console.info("competitorsToSelect " + competitorsToSelect);
  
//-------pozostawienie unikatów z tablicy competitorsToSelect za pomocą roszerzeń prototypu tablic, posortowanie----------------------

const uniques = competitorsToSelect.unique().sort();
     
console.log("Zawodnicy do wyboru: " + uniques + " Jest " + uniques.length + " zawodników do wyboru.");

addingSelects(uniques, 0); //wypełnienie firstSelect kierowcami z tablicy uniques


/*------------funkcja do wyświetlania statystyk pierwszego zawodnika i... generująca opcje wyboru do drugiego selecta (warto wydzielić)---------*/
    var showSelectedTruckerAndDisplayStats = function showSelectedTruckerAndDisplayStats(context, indexOfSelect) {
          console.log("startuejmy");
          let who = context.options[context.selectedIndex].value;
          //var select = document.getElementById("firstSelect");
          let select = context;
          let selectedOption = select.options[select.selectedIndex];
          const selectedText   = selectedOption.text;  // 'dane'
          const selectedValue  = selectedOption.value; // 'wartość'"
        console.log(">>>>>>" + who, selectedText, selectedValue);
      
          const showSelect = function showSelect() {
               console.log("Wybrano zawodnika " + selectedText);
          };
          showSelect();
      
              //------statsDisplay---------
          const showMeStats = function showMeStats(raceInfo) {

               //var raceInfo = raceInfo;
               console.warn("Czy przekazał zawodnika? " + selectedText);
               console.error("Czy przekazał rajdy? " + raceInfo);


            //--------------pętla zliaczająca pozycje do statystyk----------
                let absent = 0;
                let winner = 0;
                let second = 0;
                let third = 0;
                let podium = 0;
                let furtherPlaces = 0;
                let competed = 0;
              //  let frequency = 0;
                let miejsca = [];
                let numOfParticipants = [];
                let posPerContestants = [];
              

                for (var i = 0; i < raceInfo.length; i++) {
                  console.log("W pętli " + raceInfo[i].position);
                  console.log(selectedText);
                  var raceInfo = raceInfo;
                  var i = i;
                  let raceNr = i + 1;
                  let chosenIndex = raceInfo[i].competitors.indexOf(selectedText);
                  let positionToPush = raceInfo[i].position[chosenIndex];
                  let numOfParticipantsToPush = raceInfo[i].position.length;
                  
                  if (positionToPush != undefined) {
                      miejsca.push(positionToPush);
                      numOfParticipants.push(numOfParticipantsToPush);
                      /*--new--*/
                      posPerCont = "";
                      posPerCont += " (Race " + raceNr + ": " + positionToPush + "/" + numOfParticipantsToPush + ")";
                      posPerContestants.push(posPerCont);
                  }

                  if (raceInfo[i].position[chosenIndex] == 1) {
                    winner++;
                    competed++;
                    podium++;
                  } 
                  else if (raceInfo[i].position[chosenIndex] == 2) {
                    second++;
                    competed++;
                    podium++;
                  }
                  else if (raceInfo[i].position[chosenIndex] == 3) {
                    third++;
                    competed++;
                    podium++;
                  }
                  else if (raceInfo[i].position[chosenIndex] == undefined) {
                    absent++;
                  }
                  else {
                    console.log("Zawodnik " + selectedText);
                    console.warn("Dalsze miejsce " + raceInfo[i].position[chosenIndex] + " na " + raceInfo[i].position.length);


                    furtherPlaces++;
                    competed++;
                  }
                }
            
            //-------statystyki procentowe wyliczane po warunkach zliczających----

                let frequency = competed/raceInfo.length*100;
                let winsPct = winner/competed*100;
                let podiumPct = podium/competed*100;
            
                let fSumOfComp = function su(numOfParticipants) {
                   let sumOfComp = 0;
                    for(let i = 0; i < numOfParticipants.length; i++) { 
                      sumOfComp = sumOfComp + parseInt(numOfParticipants[i]); 
                      console.warn("wewnetrzny Test funkcji su " + sumOfComp);
                    }
                  console.error("Czy poza petlą jest co przekazać? " + sumOfComp);
                  return sumOfComp; 
                };
            
                let fSumOfPos = function suma(miejsca) {
                    let sumOfPos = 0;
                    for(let i = 0; i < miejsca.length; i++) { 
                      sumOfPos = sumOfPos + parseInt(miejsca[i]); 
                      console.error("Test funkcji suma " + sumOfPos + " wsad: " + miejsca);
                    }
                    return sumOfPos; 
                };


                let per = function per(fSumOfPos, fSumOfComp) {
                    let positionPerNumOfCompetitors = fSumOfPos(miejsca)/fSumOfComp(numOfParticipants);
                    return positionPerNumOfCompetitors;
                };

              let indexOfStatsContainer = 1 + indexOfSelect;
              let nameOfStatsContainer = "stats" + indexOfStatsContainer;
              let raceContainerNr = "race-by-race" + indexOfStatsContainer;  
              
              const statsDisplay = document.getElementById(nameOfStatsContainer);
              const st = "<div class=\"row no-gutters\"><div class=\"col-sm-7\">";
              const mid = "</div><div class=\"col-sm-5\">";
              const end = "</div></div>";

                   
        statsDisplay.innerHTML = 
            `${st} wystartował ${mid} ${competed} ${end}
            ${st} nie startował ${mid} ${absent} ${end}
            ${st} frekwencja ${mid} ${frequency.toFixed(3)} % ${end}
            ${st} pierwszy ${mid} ${winner} ${end}
            ${st} drugi ${mid} ${second} ${end}
            ${st} trzeci ${mid} ${third} ${end} 
            ${st} na podium ${mid} ${podium} ${end}
            ${st} procent wygranych ${mid} ${winsPct.toFixed(3)} % ${end}
            ${st} procent na podium ${mid} ${podiumPct.toFixed(3)} % ${end}
            ${st} dalsze miejsce ${mid} ${furtherPlaces} ${end} 
            ${st} pozycja na liczbę startujących ${mid} ${per(fSumOfPos, fSumOfComp).toFixed(3)} ${end}
            <div class=\"row no-gutters\"><div class=\"col-sm-9\">rajd po rajdzie (miejsce/liczba startujących)</div>
            <div class=\"col-sm-3\"><button class=\"btn btn-secondary btn-sm\" type=\"button\" data-toggle=\"collapse\" data-target=\"#${raceContainerNr}\" aria-expanded=\"false\" aria-controls=\"${raceContainerNr}\">Show/hide</button></div>
            <div class=\"collapse\" id=\"${raceContainerNr}\"> ${posPerContestants}</div>`;
          };

          showMeStats(raceInfo);
    };

//--- sparametryzowane dodawanie selectów ---------------------
function addingSelects(truckersTab, selectToFill) {
    for(let i = 0; i < truckersTab.length; i++) {
        function addOption(i) {
            let mySelect = null;
            let newElOption = null;
            newElOption = document.createElement("option");
            newElOption.innerHTML = truckersTab[i];
            console.warn(selects[selectToFill]);

            mySelect = selects[selectToFill];
            mySelect.appendChild(newElOption);
        }
        addOption(i);
    }
}

//-----------------przygotowanie listy oponentów możliwych do porównania-----------
function truckersToCompare() {
    let selectedOption = selects[0].options[selects[0].selectedIndex];
    let selectedText = selectedOption.text;
    let idOfSelected = uniques.indexOf(selectedText);
    let avilableToCompare =[];
    avilableToCompare = uniques.filter(function(el) {
        return el != selectedOption.text;
    });
    return avilableToCompare;
}
console.log("Sprawdzam możliwości porównania: " + truckersToCompare());


//-----------------dodanie optionow do drugiego selecta-----------
const prepareSecondSelect = function () {
    const selectToClear = selects[1];

    while (selectToClear.firstChild) {
        selectToClear.removeChild(selectToClear.firstChild);
    }

    addingSelects(truckersToCompare(), 1); //--wypełnienie SelectoToCompare kierowcami z tablicy avilableToCompare
};

//------------deklaracja wyrażenia funkcyjnego czyszczącego kontener porównania---------------
const clearingComparison = function () {
          const compareContainer = document.getElementById("comparison");
          compareContainer.innerHTML = "";
};

   
/* funkcja do porównywania wyników zawodników - wymaga sprawdzenia-------------------*/
const vs = function() {
        //var select1 = document.getElementById("firstSelect");
        let selectedOption1 = selects[0].options[selects[0].selectedIndex];
        let selectedText1 = selectedOption1.text;
        let who1 = selectedText1;
        
        //var select2 = document.getElementById("selectoToCompare");
        let selectedOption2 = selects[1].options[selects[1].selectedIndex];
        let selectedText2 = selectedOption2.text;
        let who2 = selectedText2;
        
        let who1Score = 0;
        let who2Score = 0;
        let draw = 0; 
        
        for (let i = 0; i < raceInfo.length; i++) {
            let who1Id = raceInfo[i].competitors.indexOf(who1);//index danego kierowcy w tabeli uczestników danego rajdu[i]
            let who2Id = raceInfo[i].competitors.indexOf(who2); //jw
            let who1Pos = raceInfo[i].position[who1Id];//pozycja z tabeli wzięta po odpowiadającym indexie z tabeli uczestników
            let who2Pos = raceInfo[i].position[who2Id];//jw
            let raceCounter = i + 1;

            if (raceInfo[i].position[who1Id] !== undefined || raceInfo[i].position[who2Id] !== undefined) {
                console.group();
                console.warn(who1 + " vs " + who2);
                console.log("Race#" + raceCounter + " (" + raceInfo[i].year + " #" + raceInfo[i].race + ")");
                if (raceInfo[i].position[who1Id] === undefined) {
                    console.log(who1 + " nie startował, a " + who2 + " był " + raceInfo[i].position[who2Id]);
                }
                else if (raceInfo[i].position[who2Id] === undefined) {
                    console.log(who1 + " był " + raceInfo[i].position[who1Id] + ", a " + who2 + " nie startował.");
                }
                else {
                    console.log(who1 + " był " + raceInfo[i].position[who1Id] + ", a " + who2 + " był " + raceInfo[i].position[who2Id]);
                }
                console.groupEnd();
            }


            if (who1Pos && who2Pos !== undefined) {
                if (who1Pos < who2Pos) {
                    who1Score++;
                }
                 else if (who2Pos < who1Pos) {
                    who2Score++;
                }
                 else {
                     draw++;
                 }
             }
         }
         console.log("---< Wynik H2H >---");
         console.info(who1 + " był wyżej " + who1Score);
         console.info(who2 + " był wyżej " + who2Score);
         console.info("remis był: " + draw);
         const compareDisplay = document.getElementById("comparison");
         compareDisplay.innerHTML = `<section class=\"row\"><div class=\"col-sm-12 bg-dark text-light\"><strong>Head to head</strong><br>
             ${who1} wygrał ${who1Score} <br>
             ${who2} wygrał ${who2Score} <br>
             remis był: ${draw} </section></div>`;  
     };
   
   
   
const compareBtn = document.getElementById("compareBtn");
compareBtn.addEventListener("click", vs, false); 
    
  </script>
 </body>
</html>  